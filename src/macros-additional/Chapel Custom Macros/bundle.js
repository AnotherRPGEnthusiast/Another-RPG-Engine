// ui-macro.min.js, for SugarCube 2, by Chapel
;!function(){var a={update:UIBar.setStoryElements,stow:UIBar.stow,unstow:UIBar.unstow,toggle:function(){$("#ui-bar").hasClass("stowed")?UIBar.unstow():UIBar.stow()},hide:function(){$("#ui-bar").css("display","none")},show:function(){$("#ui-bar").css("display","block")},kill:function(){$("#ui-bar").css("display","none"),$("#story").css("margin-left","2.5em")},restore:function(){$("#ui-bar").css("display","block"),$("#story").css("margin-left","20em")},jump:UI.jumpto,saves:UI.saves,restart:UI.restart,settings:UI.settings,share:UI.share,aliases:{refresh:"update",reload:"update",destroy:"kill",revive:"restore",jumpto:"jump",save:"saves",load:"saves",setting:"settings",sharing:"share"}},e=Object.keys(a);function t(s){return s&&"string"==typeof s?(s=s.toLowerCase().trim(),t=s,e.includes(t)||(r=s,s=a.aliases[r]||null)?(a[s](),!1):'Command "'+s+'" is not a valid command.'):"Command is not a string.";var r,t}Macro.add("ui",{handler:function(){Array.isArray(this.args)&&this.args.length||this.error("No commands passed to macro.");var s,r=function(s){if(!Array.isArray(s))return"Command list error.";var r=[];return s.forEach(function(s){r.push(t(s))}),r}(this.args.flatten());s=(r=r.filter(function(s){return"string"==typeof s})).join(" "),r.length&&s&&this.error(s)}})}();
// end ui-macro.min.js
// css-macro.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";function r(){try{var t,r=[].slice.call(arguments).flatten(),e=r.shift();return"string"==typeof r[0]?t=function(e){if(e.length%2!=0)return"Style rules should be a list of key/value pairs; you've passed an odd number.";var n={};return e.forEach(function(t,r){r%2==0&&(n[t]=e[r+1])}),n}(r):"object"==typeof r[0]&&(t=clone(r[0])),function(t,r){try{return"string"==typeof r?r:(t instanceof jQuery||(t=$(t)),t.css(r))}catch(t){return t.message}}(e,t)}catch(t){return t.message}}Macro.add("css",{handler:function(){var t=r(this.args);if("string"==typeof t)return this.error(t)}})}();
// end css-macro.min.js
// dialog-api-macro-set.min.js, for SugarCube 2, by Chapel
;Macro.add("dialog",{tags:["onopen","onclose"],handler:function(){var n="",o=null,e=null,t=0<this.args.length?this.args[0]:"",s=1<this.args.length?this.args.slice(1).flatten():[];this.payload.forEach(function(t,s){0===s?n=t.contents:"onopen"===t.name?o=o?o+t.contents:t.contents:e=e?e+t.contents:t.contents}),s.push("macro-"+this.name),Dialog.setup(t,s.join(" ")),Dialog.wiki(n),o&&"string"==typeof o&&o.trim()&&$(document).one(":dialogopened",function(){$.wiki(o)}),e&&"string"==typeof e&&e.trim()&&$(document).one(":dialogclosed",function(){$.wiki(e)}),Dialog.open()}}),Macro.add("popup",{handler:function(){if(this.args.length<1)return this.error("need at least one argument; the passage to display");if(!Story.has(this.args[0]))return this.error("the passage "+this.args[0]+"does not exist");var t=this.args[0],s=1<this.args.length?this.args[1]:"",n=2<this.args.length?this.args.slice(2).flatten():[];n.push("macro-"+this.name),Dialog.setup(s,n.join(" ")),Dialog.wiki(Story.get(t).processText()),Dialog.open()}}),Macro.add("dialogclose",{skipArgs:!0,handler:function(){Dialog.close()}});
// end dialog-api-macro-set.min.js
// events.min.js, for SugarCube 2, by Chapel
;Macro.add("trigger",{handler:function(){var t;return 2<this.args.length||0===this.args.length?this.error("incorrect number of arguments"):"string"!=typeof this.args[0]?this.error("first argument should be a string and a valid event type"):(t=this.args[0],void(1===this.args.length||this.args[1]&&"string"==typeof this.args[1]&&"document"===this.args[1].toLowerCase().trim()?$(document):$(this.args[1])).trigger(t))}}),Macro.add("event",{tags:["which"],handler:function(){var t,r,s=this.payload,e="",i="";return 2<this.args.length||0===this.args.length?this.error("incorrect number of arguments"):"string"!=typeof this.args[0]?this.error("first argument should be a string and a valid event type"):(2===this.args.length&&"string"==typeof this.args[1]&&(e=this.args[1]),t=this.args[0],void $(document).on(t,e,function(t){if(i=s[0].contents,1<s.length)for(r=1;r<s.length;r++)s[r].args.includes(t.which)&&(i+=s[r].contents);new Wikifier(null,i)}))}});
// end events.min.js
// articles.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var n=new Map,u=["eunuch","eucalyptus","eugenics","eulogy","euphemism","euphony","euphoria","eureka","european","euphemistic","euphonic","euphoric","euphemistically","euphonically","euphorically","heir","heiress","herb","homage","honesty","honor","honour","hour","honest","honorous","honestly","hourly","one","ouija","once","ubiquitous","ugandan","ukrainian","unanimous","unicameral","unified","unique","unisex","universal","urinal","urological","useful","useless","usurious","usurped","utilitarian","utopic","ubiquitously","unanimously","unicamerally","uniquely","universally","urologically","usefully","uselessly","usuriously"],a=["a","an"],s=/[aeiou8]/i,o=/[A-Z]+$/,l=/[UFHLMNRSX]/,i=/[.,\/#!$%\^&\*;:{}=\-_`~()]/g;function c(e){return"a"===e?"an":"a"}function r(e,r,i){var t;return 0<State.length?(t="cannot add article override -> needs to be run in StoryInit special passage or earlier",console.error(t),t):r&&"string"==typeof r?(e&&"string"==typeof e&&(e=e.toLowerCase().trim()),a.includes(e)?(r=r.trim(),void(i?n.set(r,{article:e,caseSensitive:!!i}):n.set(r.toLowerCase(),{article:e,caseSensitive:!!i}))):(t='cannot add article override -> invalid article, must be "a" or "an"',console.error(t),t)):(t="cannot add article override -> invalid word",console.error(t),t)}function t(e){var r,i,t,n,a;return r=s.test(e.first())?"an":"a",n=e,a=r,!!u.includes(n.toLowerCase())&&c(a)||(i=e,t=r,!(!o.test(i)||!l.test(i.first()))&&c(t))||r}function h(e){if(e&&"string"==typeof e){var r=e.trim().split(" ")[0].trim();return function(e){var r=(e=e.trim()).toLowerCase();if(n.has(r)||n.has(e)){var i=n.get(r)||n.get(e);return i.caseSensitive&&!n.has(e)?null:i.article}return null}(r=r.replace(i,""))||t(r)}}function p(e,r){if(!e||"string"!=typeof e)return e;var i=h(e);return(r?i.toUpperFirst():i)+" "+e}setup.articles={find:h,output:p,override:r},Macro.add("setarticle",{handler:function(){var e=r(this.args[0],this.args[1],this.args[2]);e&&"string"==typeof e&&this.error(e)}}),Macro.add(["a","an","A","An"],{handler:function(){var e=this.name.first()===this.name.first().toUpperCase();this.output.append(p(String(this.args[0]),e))}})}();
// end articles.min.js
// fs.min.js, for SugarCube 2, by Chapel
;!function(){function i(t){return console.error(t),null}function n(t){try{return JSON.stringify(t)}catch(t){return i(t)}}function s(t){try{var e;if(void 0===t)return null;if(null!=(e="string"!=typeof t?n(t):t))return LZString.compressToBase64(e)}catch(t){return i(t)}}function o(t){try{return LZString.decompressFromBase64(t)}catch(t){return i(t)}}function c(e){try{return JSON.parse(e)}catch(t){try{return JSON.parse(o(e))}catch(t){return i(t)}}}function u(t,e){try{if("$"!==e[0]&&"_"!==e[0])throw new Error("Invalid stateful variable");State.setVar?State.setVar(e,clone(t)):"$"===e[0]?State.variables[e.substr(1)]=clone(t):State.temporary[e.substr(1)]=clone(t)}catch(t){return i(t)}}function l(t,e){if("string"!=typeof e&&(e=n(e)),null!=e){(t=t&&"string"==typeof t?Util.slugify(t.trim()).toLowerCase():"file.twinedata").includes(".")||(t+=".twinedata");try{saveAs(new Blob([e],{type:"text/plain;charset=UTF-8"}),t)}catch(t){return i(t)}}}function m(t){var e=t.target.files[0],r=new FileReader,a=t.storyVar||"$fileData",n=t.dataType||"text";$(r).on("load",function(t){try{var e=t.currentTarget;if(!e.result)return;var r=function(t,e){if(null==e)return null;switch(t){case"json":return c(e);case"base64":case"b64":case"64":return c(o(e));default:return e}}(n,e.result);u(r,a),$(document).trigger({type:":import-macro",success:!0,data:clone(r),raw:e.result,storyVar:a})}catch(t){return i(t)}}),r.readAsText(e)}function f(t,e,r,a,n){var i,s,o,c,u,l,f,p,d,y=(s=e,o=r,c=a,u=n,l=$(document.createElement(u?"a":"button")).wiki(s),f=$(document.createElement("label")).attr("for","file-import").addClass("upload-file").append(l),p=$(document.createElement("input")).attr({id:"file-import",type:"file","data-format":c}).css("display","none").on("change",function(t){m(Object.assign(clone(t),{storyVar:o,dataType:$(this).attr("data-format")}))}),d=$(document.createElement("span")).append(f,p),l.ariaClick(function(){f.trigger("click")}),d);i=t&&"string"==typeof t?$(t):t||"#passages",y.appendTo(i)}setup.fileSystem={config:{defaultText:"Import",renderAsLink:!1},JSON:{stringify:n,parse:c},b64:{compress:s,decompress:o},toState:u,toFile:l,fromFile:m},window.Chapel=window.Chapel||{},Chapel.fileSystem=Chapel.fileSystem||setup.fileSystem,Macro.add("import",{handler:function(){var t=this.output,e=this.args[2],r=this.args[0],a=this.args[1];if(e&&"string"==typeof e||(e=setup.fileSystem.config.defaultText),!r||"string"!=typeof r||"$"!==r[0]&&"_"!==r[0])return this.error("Invalid variable name.");f(t,e,r,a=a&&"string"==typeof a?a.trim():"text",setup.fileSystem.config.renderAsLink)}}),Macro.add("export",{handler:function(){var t=this.args[0],e=this.args[1],r=this.args[2];if(!t)return this.error("No data to save...");r=r&&"string"==typeof r?r.trim():"text",function(t,e,r){var a;switch(r){case"json":a=n(t);break;case"base64":case"b64":case"64":a=s(n(t)||t);break;default:a="string"==typeof t?t:n(t)}l(e,a)}(t,e=e&&"string"==typeof e?e.trim():"file.twinedata",r)}})}();
// end fs.min.js
// continue.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var t=["a",":button",'*[role="button"]',".continue-macro-ignore","#ui-bar","#ui-dialog"],i=0;function o(){$(document).on("click.continue-macro keyup.continue-macro",t.join(", "),function(n){n.stopPropagation()})}function n(){if(0<State.length)return!1;var n=[].slice.call(arguments).flatten();return t=t.concat(n),!0}function c(n,t){var o,e=(o="."+Date.now().toString(36)+"-"+i,i++,o);if(t&&"function"==typeof t){var c="click.continue-macro"+e;n&&(c=c+" keyup.continue-macro"+e),$(document).one(c,function(){t.call(),$(document).off(e)})}}prehistory["%%continue-expiration"]=function(){i=0},$(document).one(":passagerender",function(){o()}),Macro.add("ignore",{handler:function(){if(!n(this.args))return this.error("the <<ignore>> macro should only be run from StoryInit or equivalent.")}}),Macro.add("cont",{tags:null,handler:function(){var n,t=this.args.includes("append"),o=this.args.includesAny("key","keypress","press","button"),e=this.payload[0].contents;t&&(n=$(document.createElement("span")).addClass("macro-"+this.name).appendTo(this.output)),c(o,this.createShadowWrapper(function(){t&&n&&n instanceof $?n.wiki(e):$.wiki(e)}))}}),setup.cont=c,setup.cont.ignore=n,setup.cont.reset=function(){var n=[].slice.call(arguments).flatten();t=t.concat(n),$(document).off(".continue-macro"),o()},window.cont=window.cont||setup.cont}();
// end continue.min.js
// operations.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var r=r||{},e=!0,t=!0,i=[0,100];function o(r,e){var t,i=[],o=0,n=1;if("string"==typeof r)i=r.split("d");else if("number"==typeof r&&e)i=[r,e];else{if(!(Array.isArray(r)&&2<=r.length))throw new TypeError("dice(): could not process arguments...");r.length=2,i=r}if(i[0]=Number(i[0]),"string"==typeof i[1]&&"F"===i[1].trim().toUpperCase()?(i[1]=3,n=-1):i[1]=Number(i[1]),i.some(function(r){return Number.isNaN(r)}))throw new TypeError("dice(): could not process arguments...");for(t=0;t<i[0];t++){o+=Math.floor(State.random()*i[1])+n}return o}function n(r,e){if("string"!=typeof r)return o(r,e);var t,i=[(t=r.trim().replace(/\s/g,"").match(/(\d+[d][\df]d*)(.*)/i))[1],Number(t[2])];return o(i[0])+i[1]}r.dice={roll:n},e&&(window.dice=window.dice||n),Number.prototype.dice||Object.defineProperty(Number.prototype,"dice",{configurable:!0,writable:!0,value:function(r){if(0===this)return 0;if(this<0)throw new TypeError("Number.prototype.dice: cannot roll a negative number of dice!");if(("string"!=typeof r||"F"!==r.trim().toUpperCase())&&(null==r||"number"!=typeof r||r<=0||!Number.isInteger(r)))throw new TypeError("Number.prototype.dice: error in argument");if(!Number.isInteger(this))throw new TypeError("Number.prototype.dice: cannot roll partial dice!");return n(this,r)}}),Number.prototype.fairmath||Object.defineProperty(Number.prototype,"fairmath",{configurable:!0,writable:!0,value:function(r){var e=i;if(this<e[0]||this>e[1])throw new TypeError("Number.prototype.fairmath called on a number that is out of the defined range (the number was "+this+").");if(null==r||"number"!=typeof r||100<r||r<-100||arguments.length<1)throw new TypeError("Number.prototype.fairmath given incorrect argument or an argument that is out of the valid 0-100 range.");if(0===r)return Math.clamp(Math.trunc(this),e[0],e[1]);if(r<0)return r*=-1,Math.clamp(Math.trunc(this-(this-e[0])*(r/e[1])),e[0],e[1]);if(0<r)return Math.clamp(Math.trunc(this+(e[1]-this)*(r/e[1])),e[0],e[1]);throw new Error("Number.prototype.fairmath encountered an unspecified error.")}}),Math.fairmath||Object.defineProperty(Math,"fairmath",{configurable:!0,writable:!0,value:function(r,e){return r.fairmath(e)}}),t&&(Math.fm||Object.defineProperty(Math,"fm",{configurable:!0,writable:!0,value:function(r,e){return r.fairmath(e)}}),Number.prototype.fm||Object.defineProperty(Number.prototype,"fm",{configurable:!0,writable:!0,value:function(r){return this.fairmath(r)}}),Number.prototype.d||Object.defineProperty(Number.prototype,"d",{configurable:!0,writable:!0,value:function(r){return this.dice(r)}}))}();
// end operations.min.js
// done.min.js, for SugarCube 2, by Chapel
;!function(){var a=1;Macro.add("done",{skipArgs:!0,tags:null,handler:function(){var n=this.payload[0].contents.trim();""!==n&&(postdisplay[":chapel-done-macro-"+a]=function(a){delete postdisplay[a],$.wiki(n)},a++)}})}();
// end done.min.js
// playtime.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var e={tryGlobal:!0,storyVar:"playtime",pauseTag:"pausetimer"};function n(){return Date.now()-State.variables[e.storyVar]}function s(t){if(t&&!(t<0)&&"number"==typeof t){var e=[];return e.push(Math.floor(t/1e3)%60),e.push(Math.floor(t/6e4)%60),e.push(Math.floor(t/36e5)),e}}State.variables[e.storyVar]=Date.now(),predisplay["start-playtime"]=function(t){delete predisplay[t],State.variables[e.storyVar]||(State.variables[e.storyVar]=Date.now())},prehistory["pause-playtime"]=function(t){tags().includes(e.pauseTag)&&(State.variables[e.storyVar]+=time())};var i=["h","hr","hrs","hour","hours"],o=["m","min","mins","minute","minutes"],u=["s","sec","secs","second","seconds"];function l(t){return function(t,e){if(t&&Array.isArray(t)&&!(t.length<3)){var a=t[2]<10?"0"+t[2]:""+t[2],r=t[1]<10?"0"+t[1]:""+t[1],n=t[0]<10?"0"+t[0]:""+t[0];return e?"<b>"+a+":"+r+"</b>:"+n:a+":"+r+":"+n}}(s(n()),t)}setup.playTime=function(t){return"string"==typeof t?(e=t,a=n(),r=s(a),i.includes(e)?r[2]:o.includes(e)?r[1]:u.includes(e)?r[0]:a):l(t);var e,a,r},e.tryGlobal&&(window.playTime=window.playTime||setup.playTime),Macro.add("playtime",{handler:function(){var t=this.args.map(function(t){return String(t).trim().toLowerCase()}),e=$(document.createElement("span")),a=l(t.includesAny(["format","f","fmt","b","bold","true"]));e.wiki(a).addClass("macro-"+this.name).appendTo(this.output)}})}();
// end playtime.min.js
// mouseover.min.js, for SugarCube 2, by Chapel
;Macro.add("mouseover",{tags:["onhover","onmouseover","onmousein","onmouseenter","onmouseout"],skipArgs:!0,handler:function(){if(this.payload.length<2)return this.error("No event tag used.");var o={mouseover:[],mousein:[],mouseout:[]},e=$(document.createElement("span")).addClass("macro-"+this.name).wiki(this.payload[0].contents).appendTo(this.output);this.payload.forEach(function(e){switch(e.name){case"onhover":case"onmouseover":o.mouseover.push(e.contents);break;case"onmousein":case"onmouseenter":o.mousein.push(e.contents);break;case"onmouseout":o.mouseout.push(e.contents);break;default:return}}),o.mouseover.length&&e.on("mouseover",this.createShadowWrapper(function(e){$.wiki(o.mouseover.join(" "))})),o.mousein.length&&e.on("mouseenter",this.createShadowWrapper(function(e){$.wiki(o.mousein.join(" "))})),o.mouseout.length&&e.on("mouseout",this.createShadowWrapper(function(e){$.wiki(o.mouseout.join(" "))}))}});
// end mouseover.min.js
// type-sim.min.js, for SugarCube 2, by Chapel
;Macro.add("typesim",{tags:null,handler:function(){var t=$(document.createElement("textarea")),e=$(document.createElement("div"));if(1!==this.args.length)return this.error("incorrect number of arguments");if("string"!=typeof this.args[0])return this.error("argument should be a string");var r=this.args[0],a="",n=r.length,i=0,s="typesim-output-"+r.replace(/[^A-Za-z0-9]/g,""),o="macro-"+this.name,d=this.payload[0].contents;t.wiki(a).attr({id:s,readonly:!0}).addClass(o).appendTo(this.output),$(document).on("keydown","#"+s,this.createShadowWrapper(function(t){i<n&&(a+=r.charAt(i),$("#"+s).empty().wiki(a)),i===n&&e.wiki(d).addClass(o).insertAfter("#"+s),i++}))}});
// end type-sim.min.js
// swap-macro-set.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var o={tryGlobal:!0,resetButton:!0,normal:"violet",selected:"red",cls:"swappable"};setup.swap=setup.swap||{};var l=null;function i(t){function a(){return t}setup.swap.current=a,o.tryGlobal&&(window.swapCurrent=a)}function r(t,a){var e=$(document.createElement("span"));return $(document.createElement("a")).wiki(t).css("color",o.normal).attr({"data-swap-flag":"false","data-orig-content":t,"data-wiki-code":a||""}).addClass(o.cls).appendTo(e).ariaClick(function(t){t.preventDefault();var a=$(this);if("true"===a.attr("data-swap-flag"))a.attr("data-swap-flag","false").css("color",o.normal),l=null;else if(l){var e=l.text(),s=a.text(),r=l.attr("data-wiki-code"),n=a.attr("data-wiki-code");l.attr("data-swap-flag","false").css("color",o.normal).empty().wiki(s),a.attr("data-swap-flag","false").css("color",o.normal).empty().wiki(e),r&&"string"==typeof r&&r.trim()&&(i(s),$.wiki(r)),n&&"string"==typeof n&&n.trim()&&(i(e),$.wiki(n)),setup.swap.current&&"function"==typeof setup.swap.current&&delete setup.swap.current,o.tryGlobal&&window.swapCurrent&&"function"==typeof window.swapCurrent&&delete window.swapCurrent,l=null}else(l=a).attr("data-swap-flag","true").css("color",o.selected)}),e}function a(){l=null,$("a."+o.cls).each(function(){var t=$(this);t.empty().wiki(t.attr("data-orig-content")).attr("data-swap-flag","false").css("color",o.normal)})}Macro.add("swap",{tags:["onswap"],skipArgs:!0,handler:function(){var t=this.payload[0].contents,a=this.payload[1]?this.payload[1].contents:"",e=this.output,s=this.name;r(t,a).addClass("macro-"+s).appendTo(e)}}),Macro.add("resetswap",{handler:function(){var t=this.args&&this.args[0]&&"string"==typeof this.args[0]?this.args[0]:"Reset";$(document.createElement(o.resetButton?"button":"a")).wiki(t).ariaClick({label:"Reset all swappable elements."},function(t){t.preventDefault(),a()}).appendTo(this.output)}}),setup.swap.create=r,setup.swap.reset=a}();
// end swap-macro-set.min.js
// notify.min.js, for SugarCube 2, by Chapel
;!function(){var n=/\d+m?s$/;function i(s,e,t){"string"==typeof s&&("number"!=typeof e&&(e=!1),$(document).trigger({type:":notify",message:s,delay:e,class:t||""}))}$(document.body).append("<div id='notify'></div>"),$(document).on(":notify",function(s){s.message&&"string"==typeof s.message&&(s.message.trim(),s.class?"string"==typeof s.class?s.class="open macro-notify "+s.class:Array.isArray(s.class)?s.class="open macro-notify "+s.class.join(" "):s.class="open macro-notify":s.class="open macro-notify",s.delay?("number"!=typeof s.delay&&(s.delay=Number(s.delay)),Number.isNaN(s.delay)&&(s.delay=2e3)):s.delay=2e3,$("#notify").empty().wiki(s.message).addClass(s.class),setTimeout(function(){$("#notify").removeClass()},s.delay))}),Macro.add("notify",{tags:null,handler:function(){var s=this.payload[0].contents,e=!1,t=!1;if(0<this.args.length){var a=n.test(this.args[0]);t="number"==typeof this.args[0]||a?(e=a?Util.fromCssTime(this.args[0]):this.args[0],1<this.args.length&&this.args.slice(1).flatten()):this.args.flatten().join(" ")}i(s,e,t)}}),setup.notify=i}();
// end notify.min.js
// fading-macro-set.min.js, for SugarCube 2, by Chapel
;Macro.add("fadein",{tags:null,handler:function(){var t,a,s=$(document.createElement("span")),e=this.payload[0].contents;if(0===this.args.length)return this.error("no arguments given");t=Util.fromCssTime(this.args[0]),a=1<this.args.length?Util.fromCssTime(this.args[1]):0,s.wiki(e).addClass("macro-"+this.name).appendTo(this.output).hide().delay(a).fadeIn(t)}}),Macro.add("fadeout",{tags:null,handler:function(){var t,a,s=$(document.createElement("span")),e=this.payload[0].contents;if(0===this.args.length)return this.error("no arguments given");t=Util.fromCssTime(this.args[0]),a=1<this.args.length?Util.fromCssTime(this.args[1]):0,s.wiki(e).addClass("macro-"+this.name).appendTo(this.output).delay(a).fadeOut(t)}});
// end fading-macro-set.min.js
// first-macro.min.js, for SugarCube 2, by Chapel
;Macro.add("first",{skipArgs:!0,tags:["then","finally"],handler:function(){var a,t=$(document.createElement("span")),n=this.payload[this.payload.length-1],s=visited()-1;a=s<this.payload.length?this.payload[s].contents:"finally"===n.name?n.contents:"",t.wiki(a).addClass("macro-"+this.name).appendTo(this.output)}});
// end first-macro.min.js
// speech.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var c=new Map;function t(t,a){if(State.length)throw new Error("addCharacter() -> must be called before story starts");t&&a?(c.has(t)&&console.error('addCharacter() -> overwriting character "'+t+'"'),c.set(t,a)):console.error("addCharacter() -> invalid arguments")}function a(t,a,e,r){var s=$(document.createElement("div")).addClass(Util.slugify(a)+" say"),n=$(document.createElement("img")).attr("src",r||c.get(a)||"");return n.attr("src")&&n.attr("src").trim()&&s.append(n),s.append($(document.createElement("p")).wiki(a.toUpperFirst())).append($(document.createElement("p")).wiki(e)),t&&(t instanceof $||(t=$(t)),s.appendTo(t)),s}setup.say=a,setup.addCharacter=t,Macro.add("character",{handler:function(){t(this.args[0],this.args[1])}}),$(document).one(":passagestart",function(){var t=Array.from(c.keys());t.push("say"),Macro.add(t,{tags:null,handler:function(){"say"!==this.name?a(this.output,this.name,this.payload[0].contents):a(this.output,this.args[0],this.payload[0].contents,this.args[1])}})})}();
// end speech.min.js
// message-macro.min.js, for SugarCube 2, by Chapel
;setup.messageMacro={},setup.messageMacro.default="Help",Macro.add("message",{tags:null,handler:function(){var e=this.payload[0].contents,a=$(document.createElement("span")),s=$(document.createElement(this.args.includes("btn")?"button":"a")),t=$(document.createElement("span"));s.wiki(0<this.args.length&&"btn"!==this.args[0]?this.args[0]:setup.messageMacro.default).ariaClick(this.createShadowWrapper(function(){a.hasClass("open")?t.css("display","none").empty():t.css("display","block").wiki(e),a.toggleClass("open")})),a.attr("id","macro-"+this.name+"-"+this.args.join("").replace(/[^A-Za-z0-9]/g,"")).addClass("message-text").append(s).append(t).appendTo(this.output)}});
// end message-macro.min.js